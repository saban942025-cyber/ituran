<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注专转  爪 - 转专 Online</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --ituran-blue: #0056b3;
            --ituran-light-blue: #e6f0ff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --dark: #343a40;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            color: var(--dark);
        }

        /* 住专 注  转专 */
        header {
            background-color: white;
            border-bottom: 3px solid var(--ituran-blue);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--ituran-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /*  专砖转 */
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            padding: 20px;
        }

        h2 {
            border-bottom: 2px solid var(--ituran-light-blue);
            padding-bottom: 10px;
            margin-top: 0;
            color: var(--ituran-blue);
            font-size: 20px;
        }

        /* 注爪 爪专  */
        #visualization {
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .vis-item.住注 { background-color: #007bff; color: white; border-color: #0056b3; }
        .vis-item.祝 { background-color: var(--success); color: white; border-color: #1e7e34; }
        .vis-item.住专拽 { background-color: var(--danger); color: white; border-color: #bd2130; }
        .vis-item.注 { background-color: #6c757d; color: white; border-color: #545b62; }

        /* 拽专 爪注 */
        .legend {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }

        /* 转  */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--ituran-light-blue); text-align: right; padding: 12px; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .status-badge { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <i class="fas fa-satellite-dish"></i>
        <span>Ituran Fleet Analytics</span>
    </div>
    <div class="user-info">
        <span>专 , .住</span>
        <i class="fas fa-user-circle" style="margin-right: 10px;"></i>
    </div>
</header>

<div class="container">
    
    <div class="grid card" style="display: flex; justify-content: space-around; text-align: center;">
        <div>
            <div style="font-size: 24px; font-weight: bold; color: var(--ituran-blue);" id="total-drivers">0</div>
            <div style="font-size: 14px; color: #666;"> 驻注</div>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: bold; color: var(--success);" id="total-pto">0</div>
            <div style="font-size: 14px; color: #666;">砖注转 祝 (PTO)</div>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: bold; color: var(--danger);" id="total-idle">0</div>
            <div style="font-size: 14px; color: #666;">砖注转 住专拽</div>
        </div>
    </div>

    <div class="card">
        <h2> 爪专  驻注转 (Timeline)</h2>
        <div class="legend">
            <div class="legend-item"><span class="dot" style="background: #007bff;"></span> 住注</div>
            <div class="legend-item"><span class="dot" style="background: var(--success);"></span> 注转 祝 (PTO)</div>
            <div class="legend-item"><span class="dot" style="background: var(--danger);"></span> 住专拽 (注 注)</div>
        </div>
        <div id="visualization"></div>
    </div>

</div>

<script>
    // 专转 Firebase 转 转 砖住驻拽转
    const firebaseConfig = {
        apiKey: "AIzaSyAXb3Of5uay1-hR9Z7WGyNwzSuUaqa4OvU",
        authDomain: "ituran-9722e.firebaseapp.com",
        databaseURL: "https://ituran-9722e-default-rtdb.firebaseio.com/",
        projectId: "ituran-9722e",
        appId: "1:18206679990:web:dc47046a30428152101717"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 转 爪专 
    const container = document.getElementById('visualization');
    const items = new vis.DataSet();
    const groups = new vis.DataSet();
    const options = {
        stack: true,
        rtl: true,
        orientation: 'top',
        maxHeight: '400px',
        editable: false
    };
    const timeline = new vis.Timeline(container, items, groups, options);

    //  转 -Firebase
    database.ref('fleet_history').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        items.clear();
        groups.clear();

        let driverCount = 0;
        
        Object.entries(data).forEach(([driver, content], index) => {
            driverCount++;
            groups.add({ id: index, content: driver });

            if (content.timeline) {
                content.timeline.forEach((event, eIndex) => {
                    // 爪专转 驻专 爪专 
                    // :  专注 砖 'start' -'status'. 
                    //   'end',  爪专 拽 砖 5 拽转 爪.
                    const startTime = new Date(event.start);
                    const endTime = event.end ? new Date(event.end) : new Date(startTime.getTime() + 5*60000);

                    items.add({
                        id: `${index}-${eIndex}`,
                        group: index,
                        start: startTime,
                        end: endTime,
                        content: event.status,
                        className: event.status.includes('PTO') ? '祝' : 
                                   event.status.includes('转注') ? '住注' : 
                                   event.status.includes('注') ? '住专拽' : '注',
                        title: `转转: ${event.address || ' 注'}`
                    });
                });
            }
        });

        document.getElementById('total-drivers').innerText = driverCount;
    });
</script>

</body>
</html>
