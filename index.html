<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Saban Elite Fleet Management</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #0046ad; --success: #00b894; --danger: #ff4757; --warning: #ffa502; --light-bg: #f8fbff; }
        body { font-family: 'Segoe UI', system-ui; background: var(--light-bg); margin: 0; color: #2d3436; }
        
        /* ×”××‘×•×¨×’×¨ ×™×•×§×¨×ª×™ */
        header { background: #fff; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eef2f7; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .menu-icon { font-size: 24px; color: var(--primary); cursor: pointer; padding: 5px; }
        .brand { font-weight: 900; color: var(--primary); font-size: 1.3rem; letter-spacing: -0.5px; }

        .side-nav { position: fixed; right: -280px; top: 0; width: 280px; height: 100%; background: #fff; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; box-shadow: -5px 0 25px rgba(0,0,0,0.1); padding: 30px 20px; }
        .side-nav.open { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 1500; backdrop-filter: blur(2px); }
        .overlay.show { display: block; }

        /* ×›×¨×˜×™×¡×™ ×©×¢×¨ × ×”×’×™× */
        .dashboard { padding: 20px; display: grid; gap: 20px; padding-bottom: 100px; }
        .driver-card { background: #fff; border-radius: 24px; padding: 20px; box-shadow: 0 10px 25px rgba(0,70,173,0.06); border: 1px solid #edf2f7; position: relative; }
        .profile-section { display: flex; align-items: center; margin-bottom: 15px; }
        .p-img { width: 65px; height: 65px; border-radius: 50%; object-fit: cover; border: 3px solid #f1f3f9; margin-left: 15px; }
        
        /* ×”××•×— ×× ×ª×— */
        .brain-box { background: #f0f7ff; border-right: 4px solid var(--primary); padding: 15px; border-radius: 12px; margin: 15px 0; font-size: 0.95rem; line-height: 1.5; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-item { background: #f8f9fb; padding: 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        
        /* ×”×’×“×¨×•×ª ×¨×•×•×—×™×•×ª */
        .settings { background: #fff; margin: 20px; border-radius: 20px; padding: 20px; border: 1px solid #e1e8ef; }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        input { padding: 12px; border: 2px solid #f1f3f9; border-radius: 12px; font-size: 0.9rem; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); }

        .btn-action { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; background: var(--primary); color: #fff; border: none; padding: 18px; border-radius: 20px; font-weight: 700; font-size: 1rem; box-shadow: 0 10px 25px rgba(0,70,173,0.3); display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
        .reliability-bar { height: 6px; background: #eee; border-radius: 10px; margin-top: 8px; overflow: hidden; }
        .reliability-fill { height: 100%; transition: 1s; }
    </style>
</head>
<body>

<header>
    <div class="menu-icon" onclick="toggleNav()"><i class="fas fa-bars"></i></div>
    <div class="brand">×—.×¡×‘×Ÿ - Saban Elite</div>
    <div class="menu-icon"><i class="far fa-user-circle"></i></div>
</header>

<div class="overlay" onclick="toggleNav()"></div>
<div class="side-nav" id="sideNav">
    <h2 style="color:var(--primary)">×ª×¤×¨×™×˜ × ×™×”×•×œ</h2>
    <div style="display:flex; flex-direction:column; gap:20px; margin-top:30px;">
        <div><i class="fas fa-chart-line"></i> ×“×•×— ×¨×•×•×—×™×•×ª ×—×•×“×©×™</div>
        <div><i class="fas fa-truck-pickup"></i> × ×™×”×•×œ ××©××™×•×ª</div>
        <div><i class="fas fa-map-marked-alt"></i> ×”×™×¡×˜×•×¨×™×™×ª ××™×§×•××™×</div>
        <hr>
        <div style="color:var(--danger)"><i class="fas fa-power-off"></i> ×”×ª× ×ª×§</div>
    </div>
</div>

<div class="settings">
    <h3 style="margin:0;"><i class="fas fa-brain"></i> ×”×’×“×¨×•×ª ××•×— (×›×¡×¤×™)</h3>
    <div class="input-row">
        <input type="number" id="dieselPrice" value="7.25" step="0.01" placeholder="×¡×•×œ×¨">
        <input type="number" id="workRate" value="500" placeholder="×ª×¢×¨×™×£ ×× ×•×£">
    </div>
</div>

<div class="dashboard" id="driverDash">
    <div style="text-align:center; padding:60px; color:#cbd5e0;">
        <i class="fas fa-cloud-upload-alt" style="font-size:50px; margin-bottom:20px;"></i>
        <br><strong>×”××¢×¨×›×ª ××•×›× ×”.</strong><br>×× × ×˜×¢×Ÿ ××ª ×“×•×— ×”××™×ª×•×¨×Ÿ ×”××œ× (5,699 ×©×•×¨×•×ª).
    </div>
</div>

<button class="btn-action" onclick="document.getElementById('fileInput').click()">
    <i class="fas fa-file-csv"></i> ×˜×¢×Ÿ ×“×•×— ××™×ª×•×¨×Ÿ ××œ×
</button>
<input type="file" id="fileInput" style="display:none" accept=".csv">

<script>
    const driverProfiles = {
        '×—×›××ª': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×× ×•×£' },
        '×‘×•×¨×”××Ÿ': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×¨××¡×”' },
        '××•×—××“ ××›×‘×¨×™×”': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×—×œ×•×§×”' }
    };

    function toggleNav() {
        document.getElementById('sideNav').classList.toggle('open');
        document.querySelector('.overlay').classList.toggle('show');
    }

    // ×¤×•× ×§×¦×™×™×ª ×”××¨×” ××–××Ÿ (HH:MM:SS) ×œ×©×¢×•×ª ×¢×©×¨×•× ×™×•×ª
    function timeToHours(timeStr) {
        if(!timeStr) return 0;
        const parts = timeStr.split(':');
        if(parts.length < 3) return 0;
        return parseInt(parts[0]) + (parseInt(parts[1])/60) + (parseInt(parts[2])/3600);
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        // ×©×™××•×© ×‘-PapaParse ×œ×§×¨×™××” ×—×¡×™× ×” ×©×œ ×”-CSV
        Papa.parse(file, {
            header: false,
            skipEmptyLines: true,
            encoding: "UTF-8", // ×”×“×•×— ×”×—×“×© ×©×œ×š ×”×•× ×‘-UTF-8
            complete: function(results) {
                processData(results.data);
            }
        });
    });

    function processData(data) {
        const stats = {};
        
        // ×”××•×— ××ª×—×™×œ ×œ×¡×¨×•×§ ××©×•×¨×” 9 (××—×¨×™ ×”××˜×-×“××˜×” ×•×”×›×•×ª×¨×•×ª)
        for(let i = 9; i < data.length; i++) {
            const row = data[i];
            if(row.length < 18) continue;

            const name = row[2].trim(); // ×ª×’ ×–×™×”×•×™
            const status = row[16] || ""; // ×©× ××¦×‘
            const speed = parseInt(row[14]) || 0;
            const limit = parseInt(row[15]) || 90;
            const addr = row[13] || "";
            const durationHours = timeToHours(row[17]); // ××©×š ×–××Ÿ ×‘×¤×•×¨××˜ ×©×¢×•×ª (HH:MM:SS)

            if(!name || name === "×ª×’ ×–×™×”×•×™" || name === "-") continue;

            if(!stats[name]) stats[name] = { ptoHours: 0, speedAlerts: 0, idleAlerts: 0, lastAddr: addr, reliability: 100 };

            if(status.includes('PTO')) stats[name].ptoHours += durationHours;
            if(status.includes('×¢×•××“ ××•× ×¢')) stats[name].idleAlerts++;
            if(speed > limit) {
                stats[name].speedAlerts++;
                stats[name].reliability -= 2;
            }
            stats[name].lastAddr = addr;
        }
        render(stats);
    }

    function render(data) {
        const dash = document.getElementById('driverDash');
        dash.innerHTML = '';
        const fuel = document.getElementById('dieselPrice').value;
        const rate = document.getElementById('workRate').value;

        Object.keys(data).forEach(name => {
            const p = driverProfiles[name] || { img: '', type: '××©××™×ª' };
            const revenue = (data[name].ptoHours * rate).toFixed(0);
            
            dash.innerHTML += `
                <div class="driver-card">
                    <div class="profile-section">
                        <img src="${p.img}" class="p-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
                        <div>
                            <div style="font-weight:800; font-size:1.2rem; color:var(--primary);">${name}</div>
                            <div style="font-size:0.85rem; color:#718096;">${p.type} | ğŸ“ ${data[name].lastAddr.split('\n').pop()}</div>
                        </div>
                    </div>

                    <div class="brain-box">
                        <i class="fas fa-robot"></i> <strong>×ª×•×‘× ×ª ××•×—:</strong><br>
                        ${revenue > 0 ? `×”×›× ×¡×” ××©×•×¢×¨×ª ××× ×•×£ ×”×™×•×: <span style="color:var(--success); font-weight:bold;">â‚ª${revenue}</span>` : '×œ× ×–×•×”×ª×” ×¢×‘×•×“×ª ×× ×•×£ ×¨×•×•×—×™×ª.'}
                        ${data[name].speedAlerts > 0 ? `<br><span style="color:var(--danger);">×–×•×”×• ${data[name].speedAlerts} ×—×¨×™×’×•×ª ××”×™×¨×•×ª!</span>` : ''}
                    </div>

                    <div class="stat-grid">
                        <div class="stat-item"><i class="fas fa-hammer" style="color:var(--primary)"></i> ${data[name].ptoHours.toFixed(2)} ×©×¢' ×× ×•×£</div>
                        <div class="stat-item"><i class="fas fa-gas-pump" style="color:var(--warning)"></i> ${data[name].idleAlerts} ××™×¨×•×¢×™ ×¡×¨×§</div>
                    </div>

                    <div style="margin-top:15px;">
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; font-weight:bold; margin-bottom:5px;">
                            <span>××“×“ ×××™× ×•×ª ×œ×•×’×™×¡×˜×™</span>
                            <span>${Math.max(data[name].reliability, 0)}%</span>
                        </div>
                        <div class="reliability-bar">
                            <div class="reliability-fill" style="width:${Math.max(data[name].reliability, 0)}%; background:${data[name].reliability < 85 ? 'var(--danger)' : 'var(--success)'}"></div>
                        </div>
                    </div>
                </div>
            `;
        });
    }
</script>
</body>
</html>
