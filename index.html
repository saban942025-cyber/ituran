<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Saban Elite Fleet AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #0046ad; --success: #00b894; --danger: #ff4757; --warning: #ffa502; --light-bg: #f4f7fa; }
        body { font-family: 'Segoe UI', system-ui; background: var(--light-bg); margin: 0; color: #2d3436; padding-bottom: 30px; }
        
        /* ×”××‘×•×¨×’×¨ ×™×•×§×¨×ª×™ */
        header { background: #fff; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #e1e8ef; position: sticky; top: 0; z-index: 1000; }
        .menu-icon { font-size: 24px; color: var(--primary); cursor: pointer; }
        .logo { font-weight: 900; color: var(--primary); font-size: 1.4rem; letter-spacing: -0.5px; }

        .side-nav { position: fixed; right: -280px; top: 0; width: 280px; height: 100%; background: #fff; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; box-shadow: -5px 0 20px rgba(0,0,0,0.1); padding: 30px 20px; }
        .side-nav.open { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 1500; backdrop-filter: blur(2px); }
        .overlay.show { display: block; }

        /* ×›×¨×˜×™×¡×™ ×©×¢×¨ × ×”×’×™× */
        .dashboard { padding: 20px; display: grid; gap: 20px; }
        .driver-gate { background: #fff; border-radius: 24px; padding: 20px; box-shadow: 0 10px 25px rgba(0,70,173,0.06); border: 1px solid #edf2f7; transition: 0.3s ease; cursor: pointer; position: relative; }
        .driver-gate:active { transform: scale(0.98); }
        .p-img { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 4px solid #f1f3f9; margin-left: 15px; }
        
        /* × ×™×ª×•×—×™ ×”××•×— */
        .brain-box { background: #f8fbff; border-right: 5px solid var(--primary); padding: 15px; border-radius: 12px; margin: 15px 0; font-size: 0.95rem; line-height: 1.5; }
        .stat-badge { background: #f1f3f9; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        .reliability-meter { height: 6px; background: #eee; border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .reliability-fill { height: 100%; background: var(--success); transition: 1s; }

        /* × ×™×”×•×œ ×“×™× ××™ */
        .settings-panel { background: #fff; margin: 20px; border-radius: 20px; padding: 20px; border: 1px solid #e1e8ef; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        input { padding: 12px; border: 2px solid #f1f3f9; border-radius: 12px; font-size: 0.9rem; outline: none; }
        input:focus { border-color: var(--primary); }

        .btn-upload { background: var(--primary); color: #fff; border: none; padding: 18px; border-radius: 18px; width: 100%; font-weight: 700; font-size: 1rem; box-shadow: 0 10px 20px rgba(0,70,173,0.25); display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div class="menu-icon" onclick="toggleNav()"><i class="fas fa-stream"></i></div>
    <div class="logo">SABAN ELITE AI</div>
    <div class="menu-icon"><i class="far fa-bell"></i></div>
</header>

<div class="overlay" onclick="toggleNav()"></div>
<div class="side-nav" id="sideNav">
    <h2 style="color:var(--primary)">× ×™×”×•×œ ××¢×¨×›×ª</h2>
    <div style="margin-top:30px; display:flex; flex-direction:column; gap:20px;">
        <div><i class="fas fa-gas-pump"></i> ×™×•××Ÿ ×¡×•×œ×¨ ×—×›×</div>
        <div><i class="fas fa-users-cog"></i> ×”×’×“×¨×•×ª × ×”×’×™×</div>
        <div><i class="fas fa-history"></i> ××¨×›×™×•×Ÿ ×“×•×—×•×ª</div>
        <div><i class="fas fa-shield-alt"></i> ×‘×§×¨×ª ×××™× ×•×ª</div>
    </div>
</div>

<div class="settings-panel">
    <h3 style="margin:0;"><i class="fas fa-brain"></i> ×”×’×“×¨×•×ª "×”××•×—" ×œ×—×™×©×•×‘ ×¨×•×•×—</h3>
    <div class="grid-inputs">
        <input type="number" id="fuelPrice" value="7.25" placeholder="××—×™×¨ ×¡×•×œ×¨">
        <input type="number" id="hourRate" value="500" placeholder="×ª×¢×¨×™×£ ×× ×•×£">
    </div>
</div>

<div class="dashboard" id="driverGrid">
    <div style="text-align:center; padding:50px; color:#a0aec0;">
        <i class="fas fa-file-invoice" style="font-size:40px; margin-bottom:15px;"></i>
        <br>×××ª×™×Ÿ ×œ×“×•×— ××™×ª×•×¨×Ÿ ××œ×...
    </div>
</div>

<div style="padding: 20px; position: sticky; bottom: 0;">
    <button class="btn-upload" onclick="document.getElementById('fileIn').click()">
        <i class="fas fa-file-excel"></i> × ×™×ª×•×— ×“×•×— ××™×ª×•×¨×Ÿ (CSV/XLS)
    </button>
    <input type="file" id="fileIn" style="display:none" accept=".csv">
</div>

<script>
    const driverProfiles = {
        '×—×›××ª': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×× ×•×£' },
        '×‘×•×¨×”××Ÿ': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×¨××¡×”' },
        '××•×—××“ ××›×‘×¨×™×”': { img: 'https://ibb.co/S76BMYt0', type: '××©××™×ª ×—×œ×•×§×”' }
    };

    function toggleNav() {
        document.getElementById('sideNav').classList.toggle('open');
        document.querySelector('.overlay').classList.toggle('show');
    }

    document.getElementById('fileIn').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const decoder = new TextDecoder('utf-8'); // ×”× ×ª×•× ×™× ×”×—×“×©×™× ×”× ×‘-UTF-8
            processSabanReport(decoder.decode(ev.target.result));
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    });

    function processSabanReport(csv) {
        const lines = csv.split('\n');
        const stats = {};
        
        // ×”××•×— ×× ×ª×— ××ª 5,699 ×”×©×•×¨×•×ª (×“×™×œ×•×’ ×¢×œ 8 ×©×•×¨×•×ª ×›×•×ª×¨×ª)
        for(let i=9; i<lines.length; i++) {
            const row = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if(!row || row.length < 20) continue;

            const name = row[2].replace(/"/g, '').trim(); // ×ª×’ ×–×™×”×•×™
            const status = row[18].replace(/"/g, ''); // ×©× ××¦×‘
            const speed = parseInt(row[14]) || 0; // ××”×™×¨×•×ª
            const speedLimit = parseInt(row[15]) || 90; // ××”×™×¨×•×ª ××•×ª×¨×ª
            const addr = row[13].replace(/"/g, ''); // ×›×ª×•×‘×ª
            const duration = parseFloat(row[20]) || 0; // ××©×š ×–××Ÿ ×‘×¤×•×¨××˜ ×©×¢×•×ª

            if(!stats[name]) stats[name] = { ptoHours: 0, speedAlerts: 0, idleAlerts: 0, lastLoc: addr, reliability: 100 };

            if(status.includes('PTO')) stats[name].ptoHours += duration;
            if(status.includes('×¢×•××“ ××•× ×¢')) stats[name].idleAlerts++;
            if(speed > speedLimit) {
                stats[name].speedAlerts++;
                stats[name].reliability -= 2;
            }
        }
        renderDashboard(stats);
    }

    function renderDashboard(data) {
        const grid = document.getElementById('driverGrid');
        grid.innerHTML = '';
        const fuel = document.getElementById('fuelPrice').value;
        const rate = document.getElementById('hourRate').value;

        Object.keys(data).forEach(name => {
            if(name.includes('×ª×’') || name === "-") return;
            const profile = driverProfiles[name] || { img: '', type: '××©××™×ª' };
            const profit = (data[name].ptoHours * rate).toFixed(0);
            
            grid.innerHTML += `
                <div class="driver-gate">
                    <div style="display:flex; align-items:center;">
                        <img src="${profile.img}" class="p-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
                        <div>
                            <div style="font-weight:800; font-size:1.2rem; color:var(--primary);">${name}</div>
                            <div style="font-size:0.85rem; color:#718096;">${profile.type} | ğŸ“ ${data[name].lastLoc.split(',')[0]}</div>
                        </div>
                    </div>

                    <div class="brain-box">
                        <i class="fas fa-robot"></i> <strong>×”××•×— ×× ×ª×—:</strong><br>
                        ${profit > 0 ? `×¤×¢×™×œ×•×ª ×× ×•×£ ×”× ×™×‘×” <span style="color:var(--success); font-weight:bold;">â‚ª${profit}</span> ×”×™×•×.` : '×œ× ×–×•×”×ª×” ×”×›× ×¡×” ×™×©×™×¨×” ××¢×‘×•×“×ª ×× ×•×£.'}
                        ${data[name].speedAlerts > 0 ? `<br><span style="color:var(--danger);">×–×•×”×• ${data[name].speedAlerts} ×—×¨×™×’×•×ª ××”×™×¨×•×ª!</span>` : ''}
                    </div>

                    <div style="display:flex; flex-wrap:wrap; gap:10px;">
                        <div class="stat-badge"><i class="fas fa-hammer"></i> ${data[name].ptoHours.toFixed(1)} ×©×¢' ×× ×•×£</div>
                        <div class="stat-badge"><i class="fas fa-gas-pump"></i> ${data[name].idleAlerts} ×¡×¨×§</div>
                        <div class="stat-badge"><i class="fas fa-tachometer-alt"></i> ×—×¨×™×’×•×ª ××”×™×¨×•×ª: ${data[name].speedAlerts}</div>
                    </div>

                    <div style="margin-top:15px;">
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; font-weight:bold;">
                            <span>××“×“ ×××™× ×•×ª (××™×ª×•×¨×Ÿ vs ×ª×¢×•×“×•×ª)</span>
                            <span>${Math.max(data[name].reliability, 0)}%</span>
                        </div>
                        <div class="reliability-meter">
                            <div class="reliability-fill" style="width:${Math.max(data[name].reliability, 0)}%; background:${data[name].reliability < 80 ? 'var(--danger)' : 'var(--success)'}"></div>
                        </div>
                    </div>
                </div>
            `;
        });
    }
</script>
</body>
</html>
