<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Saban Fleet Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #0056b3;
            --bg-light: #f8fbff;
            --text-dark: #2d3436;
            --success: #00b894;
            --danger: #d63031;
            --accent: #0984e3;
        }

        body { font-family: 'Segoe UI', system-ui; background: var(--bg-light); margin: 0; color: var(--text-dark); overflow-x: hidden; }

        /* 转驻专 专专 拽专转 */
        .header { background: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .hamburger { font-size: 24px; cursor: pointer; color: var(--primary); }
        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); letter-spacing: 1px; }

        .side-menu { position: fixed; right: -280px; top: 0; width: 280px; height: 100%; background: white; transition: 0.4s; z-index: 2000; box-shadow: -5px 0 15px rgba(0,0,0,0.1); padding: 20px; }
        .side-menu.open { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 1500; }
        .overlay.show { display: block; }

        /* 驻转专 砖注专  */
        .driver-grid { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; }
        .driver-gate { 
            background: white; border-radius: 20px; padding: 20px; display: flex; align-items: center; 
            box-shadow: 0 4px 12px rgba(0,111,255,0.08); border: 1px solid rgba(0,0,0,0.03);
            transition: 0.3s; cursor: pointer; position: relative; overflow: hidden;
        }
        .driver-gate:active { transform: scale(0.97); }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); margin-left: 15px; }
        .driver-info h3 { margin: 0; font-size: 1.1rem; }
        .driver-info p { margin: 3px 0; font-size: 0.85rem; color: #636e72; }

        /*   */
        .management-card { background: white; margin: 20px; border-radius: 15px; padding: 15px; border-top: 4px solid var(--accent); }
        .input-group { display: flex; gap: 10px; margin-top: 10px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem; }

        /* 住住 */
        .status-badge { position: absolute; left: 20px; top: 20px; font-size: 10px; font-weight: bold; padding: 4px 10px; border-radius: 20px; }
        .active { background: #e3fcef; color: var(--success); }
        .idle { background: #fff0f0; color: var(--danger); }

        .analysis-box { background: #f0f7ff; padding: 15px; border-radius: 10px; margin: 10px 0; font-size: 0.9rem; border-right: 4px solid var(--primary); }
    </style>
</head>
<body>

<div class="header">
    <div class="hamburger" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
    <div class="logo">SABAN FLEET AI</div>
    <div style="width: 24px;"></div>
</div>

<div class="overlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
    <h2>转驻专 </h2>
    <p><i class="fas fa-user-edit"></i> 注专转 </p>
    <p><i class="fas fa-gas-pump"></i>  转拽</p>
    <p><i class="fas fa-file-invoice-dollar"></i> 转 专转</p>
    <hr>
    <p style="color:var(--danger)"><i class="fas fa-sign-out-alt"></i> 转转拽</p>
</div>

<div class="management-card">
    <h3 style="margin-top:0"><i class="fas fa-brain"></i> 专转 ""</h3>
    <div class="input-group">
        <input type="number" id="dieselPrice" placeholder="专 住专 " value="7.20">
        <input type="number" id="hourlyRate" placeholder="专 砖注 (砖'')" value="500">
    </div>
    <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">*  砖 专转 爪转 驻 转 .</p>
</div>

<div class="upload-section" style="padding: 0 20px;">
    <button onclick="document.getElementById('fileIn').click()" style="width:100%; padding:15px; border-radius:10px; border:none; background:var(--primary); color:white; font-weight:bold;">
        <i class="fas fa-upload"></i> 注  转专 
    </button>
    <input type="file" id="fileIn" accept=".csv" style="display:none">
</div>

<div class="driver-grid" id="driverGrid">
    <div class="driver-gate" onclick="alert('注 转 注拽...')">
        <img src="https://ibb.co/S76BMYt0" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
        <div class="driver-info">
            <h3>转 (砖转 祝)</h3>
            <p> 转 转...</p>
            <div class="analysis-box">
                : "专,  驻专拽 爪 <strong>砖专 砖</strong> 专 14:00"
            </div>
        </div>
        <span class="status-badge active"></span>
    </div>
</div>

<script>
    let driverData = {};

    function toggleMenu() {
        document.getElementById('sideMenu').classList.toggle('open');
        document.querySelector('.overlay').classList.toggle('show');
    }

    document.getElementById('fileIn').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const decoder = new TextDecoder('windows-1255');
            const csv = decoder.decode(event.target.result);
            processFleet(csv);
        };
        reader.readAsArrayBuffer(file);
    });

    function processFleet(csv) {
        const lines = csv.split('\n');
        const summary = {};
        
        //  住专拽
        for(let i=7; i<lines.length; i++) {
            const row = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if(!row || row.length < 9) continue;
            
            const name = row[1].replace(/"/g, '').trim();
            const status = row[8].replace(/"/g, '').trim();
            const time = row[0].replace(/"/g, '');

            if(!summary[name]) summary[name] = { pto: 0, idle: 0, lastTime: time, lastAddr: row[6].replace(/"/g, '') };
            if(status.includes('PTO')) summary[name].pto++;
            if(status.includes('注')) summary[name].idle++;
        }
        renderGates(summary);
    }

    function renderGates(data) {
        const grid = document.getElementById('driverGrid');
        grid.innerHTML = '';
        
        const diesel = document.getElementById('dieselPrice').value;
        const rate = document.getElementById('hourlyRate').value;

        Object.keys(data).forEach(name => {
            if(name === "转 " || name === "-") return;
            
            // 拽 注转 驻 住 
            let advice = ":  ";
            if(name.includes('转') && moment(data[name].lastTime, "DD/MM/YYYY HH:mm").hour() >= 14) {
                advice = "锔 专! 转  驻专拽 (专 14:00)";
            }
            if(data[name].idle > 5) {
                const loss = (data[name].idle * 0.5 * diesel).toFixed(2);
                advice = ` 驻住 拽 住专拽: -${loss} 砖"`;
            }

            grid.innerHTML += `
                <div class="driver-gate">
                    <img src="https://ibb.co/S76BMYt0" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
                    <div class="driver-info">
                        <h3>${name}</h3>
                        <p> ${data[name].lastAddr.split(',')[0]}</p>
                        <p>憋 注 专: ${data[name].lastTime.split(' ')[1]}</p>
                        <div class="analysis-box">${advice}</div>
                    </div>
                    <span class="status-badge ${data[name].idle > 5 ? 'idle' : 'active'}">
                        ${data[name].pto > 0 ? '注转 祝' : '驻注'}
                    </span>
                </div>
            `;
        });
    }
</script>
</body>
</html>
