<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Ituran App</title>
    <style>
        /* 注爪 驻拽爪 */
        body { margin: 0; padding-bottom: 70px; background: #f0f2f5; font-family: sans-serif; }
        .app-header { background: #0056b3; color: white; padding: 20px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 100; }
        .status-card { background: white; margin: 10px; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .anomaly-badge { background: #ff4d4d; color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; float: left; }
        .driver-btn { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 10px; border: none; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; font-weight: bold; }
        .driver-btn:active { background: #e6f0ff; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="app-header">注专转  爪 - .住</div>

<div class="status-card">
    <h3> 注转  </h3>
    <input type="file" id="appUpload" accept=".csv" style="width: 100%;">
</div>

<div id="driver-list" style="padding: 10px;">
    </div>

<div class="nav-bar">
    <span> 转</span>
    <span> </span>
    <span>锔 专转</span>
</div>

<script>
    //  砖拽专 转 -CSV 砖注转 (123.csv)
    function processAppCSV(text) {
        const rows = text.split('\n');
        const list = document.getElementById('driver-list');
        list.innerHTML = "<h3>专砖转  :</h3>";

        const drivers = {};
        for (let i = 7; i < rows.length; i++) {
            const cols = rows[i].split(',');
            if (cols.length < 10) continue;
            const name = cols[1].replace(/"/g, '');
            const status = cols[8].replace(/"/g, '');
            
            if (!drivers[name]) drivers[name] = { pto: 0, idle: 0 };
            if (status.includes('PTO')) drivers[name].pto++;
            if (status.includes('注 注')) drivers[name].idle++;
        }

        Object.keys(drivers).forEach(name => {
            if (name === "转 " || name === "-") return;
            const anomaly = drivers[name].idle > 0 ? '<span class="anomaly-badge">专转 住专拽!</span>' : '';
            list.innerHTML += `
                <button class="driver-btn">
                    <span>${name}</span>
                    <span>${drivers[name].pto} 驻注转 祝 ${anomaly}</span>
                </button>
            `;
        });
    }

    document.getElementById('appUpload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (ev) => processAppCSV(ev.target.result);
        reader.readAsText(e.target.files[0], 'windows-1255');
    });
</script>

</body>
</html>
